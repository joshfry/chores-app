# Family Chores Management App - Cursor Rules

## Project Overview

Full-stack family chores management application with Node.js/Express backend and React/TypeScript frontend.

## Project Structure

```
chores/
â”œâ”€â”€ backend/           # Node.js Express API server
â”‚   â”œâ”€â”€ app.js         # Express app setup & configuration
â”‚   â”œâ”€â”€ index.js       # Server entry point
â”‚   â”œâ”€â”€ config/        # Configuration files
â”‚   â”‚   â””â”€â”€ server.js  # Server configuration
â”‚   â”œâ”€â”€ middleware/    # Custom middleware
â”‚   â”‚   â”œâ”€â”€ logger.js  # Request logging
â”‚   â”‚   â””â”€â”€ json-only.js # JSON-only API validation
â”‚   â”œâ”€â”€ routes/        # API route handlers
â”‚   â”‚   â”œâ”€â”€ index.js   # Main API routes
â”‚   â”‚   â”œâ”€â”€ basic.js   # Health & documentation routes
â”‚   â”‚   â”œâ”€â”€ children.js
â”‚   â”‚   â”œâ”€â”€ chores.js
â”‚   â”‚   â””â”€â”€ assignments.js
â”‚   â””â”€â”€ tests/         # Jest test files
â”œâ”€â”€ frontend/          # React TypeScript app (when created)
â””â”€â”€ .gitignore         # Shared gitignore for monorepo
```

## Technology Stack

### Backend

- **Runtime**: Node.js 20.10.0
- **Framework**: Express.js 5.x with TypeScript
- **Database**: SQLite with Prisma ORM (active, 53KB database)
- **Authentication**: Passwordless (magic tokens) + WebAuthn support
- **Testing**: Jest + Supertest (56 tests, 92%+ coverage)
- **CORS**: Enabled for frontend integration

### Frontend

- **Framework**: React 19.1 with TypeScript
- **Styling**: Tailwind CSS (utility-first framework)
- **Routing**: React Router v6
- **State Management**: Context API for authentication
- **Testing**: Jest + React Testing Library (11 tests, 85%+ coverage)
- **Build**: Create React App with TypeScript template
- **Package Manager**: pnpm (monorepo workspace)

## API Design Standards

### Core Models

1. **Children**

   ```json
   {
     "id": number,
     "name": string,
     "birthdate": "YYYY-MM-DD"
   }
   ```

2. **Chores**

   ```json
   {
     "id": number,
     "title": string,
     "description": string,
     "difficulty": "easy|medium|hard",
     "is_recurring": boolean,
     "recurrence_days": ["monday", "wednesday", "friday"] // Array of days
   }
   ```

3. **Assignments** (Weekly Collections)
   ```json
   {
     "id": number,
     "child_id": number,
     "start_date": "YYYY-MM-DD", // Always Sunday
     "end_date": "YYYY-MM-DD", // Always Saturday
     "status": "assigned|in_progress|completed|missed",
     "chores": [
       {
         "id": number,
         "chore_id": number,
         "status": "pending|completed|skipped",
         "completed_on": "monday" | null
       }
     ]
   }
   ```

### API Endpoints

- **Children**: `/api/children` (GET, POST, PUT, DELETE)
- **Chores**: `/api/chores` (GET, POST, PUT, DELETE)
- **Assignments**: `/api/assignments` (GET, POST, DELETE)
  - `/api/assignments/:id/chores/:choreId` (PATCH) - Update individual chore status
- **Dashboard**: `/api/dashboard/stats`
- **Health**: `/health`
- **Root**: `/` (API documentation)

### API Security & Standards

- **JSON-Only**: All `/api/*` endpoints require `Accept: application/json`
- **Content-Type**: POST/PUT/PATCH require `Content-Type: application/json`
- **Error Codes**: 406 for wrong Accept, 415 for wrong Content-Type
- **Response Format**: Always return `{ success: boolean, data?, error?, message? }`

## Code Style & Standards

### JavaScript/TypeScript

- **Quotes**: Double quotes `"` preferred
- **Semicolons**: Required
- **Trailing Commas**: Always include
- **Line Length**: Reasonable breaks for readability
- **Async/Await**: Prefer over Promises.then()

### File Naming

- **Backend**: kebab-case for files, camelCase for variables
- **Frontend**: PascalCase for components, camelCase for utilities
- **Tests**: `*.test.js` in `tests/` directory

### Git Standards

- **Commit Format**: `(<Agent Name>): <Short, clear summary of work>`
  - Example: `(DEV): Add db:push npm script for Render deployment`
  - Example: `(DEV): Fix assignment creation validation`
  - Example: `(DEV): Document npm scripts and deployment standards`
  - **Agent Name**: Use `DEV` for AI assistant commits, or your name for manual commits
- **Branches**: Use feature branches for new functionality
- **Ignore**: Comprehensive `.gitignore` for Node.js, React, and databases

## Development Workflow

### Current Phase: Backend Development

1. âœ… Basic Express server with JSON-only middleware
2. âœ… Mock API endpoints for all models
3. âœ… Comprehensive test suite for API functionality
4. ğŸ”„ Database integration (SQLite)
5. â³ Frontend React app creation
6. â³ API integration between frontend/backend

### Testing Requirements

- **Backend**: Jest + Supertest for all API endpoints
- **Coverage**: Focus on API validation, error handling, business logic
- **Test Data**: Use consistent mock data across tests
- **Commands**: `npm test` to run all tests

### Database (When Implemented)

- **Type**: SQLite for simplicity
- **ORM**: Consider simple query builder or raw SQL
- **Migrations**: Simple schema files
- **Location**: `backend/database.sqlite` (gitignored)

## Developer Profile & Assistance Guidelines

### User Experience Level

**CRITICAL: This developer is a STAFF-LEVEL FRONTEND DEVELOPER** ğŸ¯

- âœ… **Frontend Expertise**: React, TypeScript, Tailwind CSS, modern frontend patterns
- âœ… **Strong Skills**: Component architecture, state management, UI/UX, testing
- âŒ **Needs Help With**: Backend development (Node.js, Express, databases, APIs, authentication)
- âŒ **Don't Explain**: Basic React concepts, TypeScript usage, frontend best practices

### How to Assist This Developer

**DO:**

- ğŸ¯ **Focus on backend concepts** - Node.js, Express, databases, API design
- ğŸ”§ **Explain server-side patterns** - middleware, authentication, error handling
- ğŸ“š **Provide backend examples** - route handlers, database queries, security
- ğŸš€ **Suggest backend improvements** - performance, architecture, DevOps
- ğŸ’¡ **Explain backend debugging** - server logs, API testing, database issues

**DON'T:**

- âŒ **Explain basic frontend concepts** - they already know React/TypeScript very well
- âŒ **Suggest basic UI improvements** - they have strong frontend skills
- âŒ **Over-explain JavaScript fundamentals** - focus on backend-specific JS patterns
- âŒ **Assume they need frontend architecture help** - they're already expert-level

### Communication Style

- **Backend-focused explanations** with depth and technical detail
- **Assume frontend competence** and focus on backend learning
- **Practical examples** for backend concepts they're still learning

## AI Assistant Guidelines

### **ğŸ¨ STYLING POLICY (CRITICAL)**

**This project uses Tailwind CSS for all styling.**

- âœ… **DO**: Use Tailwind utility classes in className props
- âœ… **DO**: Follow Tailwind conventions for responsive design (md:, lg:, etc.)
- âœ… **DO**: Preserve component structure, props, and data-testid attributes
- âŒ **DON'T**: Create styled-components (project no longer uses them)
- âŒ **DON'T**: Use inline `style={{}}` props unless absolutely necessary
- âŒ **DON'T**: Create custom CSS files or suggest other CSS frameworks

**See `ai-docs/STYLING_APPROACH.md` for complete details.**

### **ğŸ¢ ENTERPRISE-READY REQUIREMENT**

**CRITICAL: Everything developed for this project MUST be enterprise-ready.**

- âš ï¸ **MANDATORY**: Read `ai-docs/ENTERPRISE_STANDARDS.md` before making ANY changes
- âš ï¸ **MANDATORY**: Read `ai-docs/.agent-notes.md` for critical agent instructions
- âœ… **90%+ test coverage** required (currently: 110+ comprehensive tests)
- âœ… **Production-grade security** (proper auth, validation, error handling)
- âœ… **Professional documentation** (complete guides, API docs, troubleshooting)
- âœ… **TypeScript with full type safety** (no `any` types in production code)
- âœ… **CI/CD ready** (automated testing, proper exit codes, workspace config)

**This is NOT a prototype or hobby project - it's enterprise-grade software.**

### Server Management Policy

**CRITICAL: AI assistants must NEVER start servers directly.**

- âŒ **DO NOT** run `npm start`, `npm run dev`, `pnpm dev`, or any server commands
- âŒ **DO NOT** start backend or frontend servers using any method
- âŒ **DO NOT** run commands that start long-running processes
- âœ… **DO** help diagnose server issues and suggest solutions
- âœ… **DO** suggest commands for the USER to run themselves
- âœ… **DO** check what processes are using ports (e.g., `lsof -ti:3001`)
- âœ… **DO** help kill processes blocking ports if requested

### Why This Policy Exists

1. **Prevents Confusion**: Multiple agents starting servers creates port conflicts
2. **User Control**: Developer maintains full control over their environment
3. **Clear Boundaries**: Agent focuses on code, user manages processes
4. **Debugging**: Easier to troubleshoot when user controls server lifecycle

### Acceptable Server-Related Actions

- Reading configuration files (`package.json`, `nodemon.json`, etc.)
- Analyzing server code for issues (`index.js`, `app.js`, etc.)
- Checking port availability (`lsof -ti:PORT`)
- Suggesting environment variables or configuration changes
- Helping with server setup and configuration
- Writing/editing server code and middleware

### Communication Guidelines

When server issues arise:

- Clearly state what the user should run: `"You should run: pnpm dev:backend"`
- Explain the expected outcome: `"This will start the backend on port 3001"`
- Provide troubleshooting steps: `"If you get EADDRINUSE, run: lsof -ti:3001"`
- Focus on diagnosis, not execution

## Key Decisions Made

### Technical Choices

1. **Monorepo Structure**: Single repo with backend/frontend separation
2. **TypeScript**: Used throughout backend and frontend
3. **Tailwind CSS**: Utility-first CSS framework for consistent, rapid UI development
4. **Express 5.x**: Latest stable version
5. **JSON-Only API**: Strict content negotiation for API endpoints

### Architecture Decisions

1. **RESTful Design**: Standard HTTP methods and status codes
2. **Separation of Concerns**: Routes, controllers, models separate
3. **Error Handling**: Consistent error response format
4. **Incremental Development**: Small steps, test each phase
5. **Modular Structure**: Middleware, config, and routes in separate files
6. **Single Responsibility**: Each file has one clear purpose

### Avoided Technologies

- **Styled-components**: Migrated to Tailwind CSS for better DX
- **Complex ORMs**: Keep database layer simple with Prisma

## Future Development Guidelines

### When Adding New Features

1. **API First**: Design endpoint before implementation
2. **Test Driven**: Write tests before or alongside code
3. **Documentation**: Update this file and API docs
4. **Incremental**: Small, testable changes

### When Making Changes

1. **Backward Compatibility**: Don't break existing API contracts
2. **Database Migrations**: Plan schema changes carefully
3. **Error Handling**: Maintain consistent error responses
4. **Security**: Validate all inputs, maintain JSON-only policy

### Code Quality

1. **Linting**: Fix linting errors before committing
2. **Testing**: Maintain high test coverage
3. **Performance**: Monitor API response times
4. **Security**: Regular dependency updates

### npm Scripts & Deployment Standards

**CRITICAL: Always use npm scripts for deployment commands, not raw commands.**

#### Why npm Scripts?

- âœ… **Portable**: Works across any hosting provider
- âœ… **Path Resolution**: npm automatically resolves paths relative to `package.json`
- âœ… **Maintainable**: Commands are version-controlled with your code
- âœ… **Discoverable**: All commands documented in `package.json`
- âœ… **Provider-Agnostic**: No hard-coded paths or assumptions

#### Standard Deployment Scripts

**Backend (`backend/package.json`):**

```json
{
  "scripts": {
    "start": "node dist/index.js", // Production server start
    "build": "tsc --project tsconfig.build.json", // TypeScript compilation
    "postinstall": "prisma generate", // Auto-generate Prisma Client
    "db:push": "prisma db push --accept-data-loss --skip-generate" // Database initialization
  }
}
```

**Frontend (`frontend/package.json`):**

```json
{
  "scripts": {
    "start": "react-scripts start", // Development server
    "build": "DISABLE_ESLINT_PLUGIN=true react-scripts build", // Production build
    "test": "react-scripts test" // Run tests
  }
}
```

#### Deployment Command Examples

**Good âœ… (Use npm scripts):**

- `npm run build` - Platform-independent, works anywhere
- `npm run db:push` - Clean, discoverable, maintainable
- `npm start` - Standard convention

**Bad âŒ (Avoid raw commands):**

- `cd /some/path && npx prisma db push` - Hard-coded paths break portability
- `tsc --project tsconfig.build.json` - Not discoverable without reading code
- `node dist/index.js` - Should be wrapped in `npm start`

#### Adding New Deployment Scripts

When adding operations needed for deployment:

1. **Add to `package.json` scripts section**
2. **Use descriptive names**: `db:push`, `db:migrate`, `build:prod`
3. **Document in comments** if the purpose isn't obvious
4. **Test locally first**: Run `npm run <script>` to verify it works

#### Example: Database Initialization Script

```json
{
  "scripts": {
    "db:push": "prisma db push --accept-data-loss --skip-generate",
    "db:migrate": "prisma migrate deploy",
    "db:seed": "node scripts/seed.js",
    "db:reset": "prisma migrate reset --force"
  }
}
```

**Usage in hosting providers:**

- **Render.com Pre-Deploy**: `npm run db:push`
- **Vercel Build**: `npm run build`
- **Railway Start**: `npm start`

**No provider-specific path assumptions needed!**

## Common Commands

### Backend Development

```bash
cd backend
npm install          # Install dependencies
npm start           # Start server (production)
npm run dev         # Start server (development)
npm test            # Run test suite
```

### Frontend Development (When Created)

```bash
cd frontend
npm install          # Install dependencies
npm start           # Start dev server
npm test            # Run tests
npm run build       # Build for production
```

## Environment Setup

- **Node.js**: v18+ recommended
- **npm**: Latest stable version
- **Port**: Backend runs on 3001, frontend on 3000 (when created)

---

_Last Updated: September 30, 2025_  
_Project Status: **MVP Complete** - Full-stack app with auth, database, testing, and CI/CD_  
_Quality Level: **Enterprise Production-Ready**_
